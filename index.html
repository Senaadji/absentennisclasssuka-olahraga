<script>
  document.addEventListener("DOMContentLoaded", function () {
    const today = new Date().toISOString().split("T")[0];
    document.getElementById("tanggal").value = today;
    updateClock();
  });

  function updateClock() {
    const now = new Date();
    const jam = now.getHours().toString().padStart(2, '0');
    const menit = now.getMinutes().toString().padStart(2, '0');
    const detik = now.getSeconds().toString().padStart(2, '0');
    document.getElementById('clock').textContent = `Waktu Sekarang: ${jam}:${menit}:${detik}`;
    setTimeout(updateClock, 1000);
  }

  function setCurrentTime() {
    const now = new Date();
    const jam = now.getHours().toString().padStart(2, '0');
    const menit = now.getMinutes().toString().padStart(2, '0');
    document.getElementById('jam').value = `${jam}:${menit}`;
    return true;
  }

  document.querySelector("form").addEventListener("submit", function(e) {
    e.preventDefault();
    setCurrentTime();

    const form = e.target;
    const data = new FormData(form);
    const loading = document.getElementById("loading");
    const submitButton = form.querySelector("button");

    // Tampilkan loading dan disable tombol
    loading.style.display = "block";
    submitButton.disabled = true;

    const formData = {
      nama: form.name.value,
      tanggal: form.tanggal.value,
      jam: document.getElementById("jam").value,
      kategori: form.kategori.value,
      level: form.level.value,
      lapangan: form.lapangan.value,
      kehadiran: "Hadir"
    };

    fetch(form.action, {
      method: "POST",
      body: data
    })
    .then(response => response.text())
    .then(result => {
      document.getElementById("absenForm").style.display = "none";
      loading.style.display = "none";

      const summary = document.getElementById("summary");
      const list = document.getElementById("summaryList");
      list.innerHTML = `
        <li><strong>Nama:</strong> ${formData.nama}</li>
        <li><strong>Tanggal:</strong> ${formData.tanggal}</li>
        <li><strong>Jam:</strong> ${formData.jam}</li>
        <li><strong>Kategori:</strong> ${formData.kategori}</li>
        <li><strong>Level:</strong> ${formData.level}</li>
        <li><strong>Lapangan:</strong> ${formData.lapangan}</li>
        <li><strong>Kehadiran:</strong> Hadir</li>
      `;
      summary.style.display = "block";
    })
    .catch(error => {
      loading.style.display = "none";
      submitButton.disabled = false;
      alert("‚ùå Gagal mengirim absen. Silakan coba lagi.");
    });
  });
</script>

